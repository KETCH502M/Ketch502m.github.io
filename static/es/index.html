<!DOCTYPE html>
<html lang="en">
  <head>
     <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#39beef">
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-2MGMW54B4X"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-2MGMW54B4X");
    </script>
   
<meta name="theme-color" content="#24ecff">
    <audio id="successSound" src="/assets/audio/success.mp3"></audio>
    <audio id="successSound" src="/assets/audio/error.mp3"></audio>
    <audio id="successSound" src="/assets/audio/error2.mp3"></audio>
    <link rel="stylesheet" href="./css/s.search.css" />
    <script src="./js/js.delay.js"></script>
    <!--<link rel="stylesheet" href="https://cdn.healtpix.tk/css/home.style.css" />-->
    <link rel="stylesheet" href="./css/home.style.css" />
    <link rel="stylesheet" href="./css/all.min.css" />
    <link rel="stylesheet" href="./css/es-s.css" />

    <title>Healtpix - Inicio</title>
    <div id="popup" class="popup">
      <h2>Bienvenido</h2>
      <p>¡Ve que te encuentras, como una version buena de Minecraft, jeje!</p>
      <button class="btn" onclick="closePopup()">Cerrar</button>
    </div>

    <div id="overlay" class="overlay"></div>
  </head>
  <body class="bg-img">
    <header>
      <div class="navigation">
        <ul>
          <li class="list active">
            <a href="#" onclick="redirigirDespuesDeRetraso('/')">
              <span class="icon">
                <ion-icon name="home-outline"></ion-icon>
              </span>
              <span class="text">Inicio</span>
            </a>
          </li>
          <li class="list">
            <a href="#" onclick="redirigirDespuesDeRetraso('descargas')">
              <span class="icon">
                <ion-icon name="download-outline"></ion-icon>
              </span>
              <span class="text">Descargas</span>
            </a>
          </li>
          <li id="wgam" class="list">
            <a href="#" onclick="redirigirDespuesDeRetraso('juegos')">
              <span class="icon">
                <ion-icon name="game-controller-outline"></ion-icon>
              </span>
              <span class="text">Juegos</span>
            </a>
          </li>
          <div class="indicator"></div>
        </ul>
      </div>
    </header>
    <script src="./js/js.movement.js"></script>
    <div class="countdown">
      <p class="timeout">Noche buena en:</p>
      <section>
        <p>
          <span id="days"></span> días <span id="hours"></span> horas
          <span id="minutes"></span> minutos <span id="seconds"></span> segundos
        </p>
      </section>
      <script src="./js/date_time.js"></script>
    </div>
    <br />
    <br />
   <!--- <div id="dwapp" class="dwapp">
      <a
        id="dw-1"
        href="#"
        onclick="redirigirDespuesDeRetraso('/assets/app/app.apk')"
        >Descarga la versión para Android</a
      >
    </div>--->
    <div id="dwapp" class="dwapp">
      <button id="dw-1" style="display: none;">Instalar app web</button>
    </div>
    <script
      type="module"
      src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"
    ></script>
    <script
      nomodule
      src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"
    ></script>
    <footer>
      <form id="codeForm">
        <label for="codeInput"
          >Introduce un
          <span class="tooltip"
            >código<span class="tooltiptext">¡Solo código numerico!</span></span
          >
          de 6 dígitos:</label
        >
        <input
          type="text"
          id="codeInput"
          name="codeInput"
          placeholder="000-000"
          maxlength="7"
          required
          title="Por favor, ingresa un codigo de 6 dígitos."
        />
        <!--<button type="submit">Enviar</button>-->
      </form>

      <div class="toast" id="toast"></div>
      <br />
      <a
        href="info.html"
        style="color: #7196c0; text-decoration: none; font-weight: bold"
        >Información de la página</a
      >
      <script src="./js/code-s.js"></script>
      <!--<ul class="language">
        <br/>
        <li><a href="../es/">Español</a></li>
        <li><a href="../en/">Inglés</a></li>
        <li><a href="../ja/">Japonés</a></li>
        <li><a href="../pt/">Portugués</a></li>
      </ul> -->
    </footer>
   <!-- <script>
      // Función para solicitar permiso de notificación
      function requestNotificationPermission() {
        Notification.requestPermission().then(function (result) {
          if (result === "granted") {
            // El permiso fue concedido
            localStorage.setItem("notificationPermission", "granted");
          } else if (result === "denied") {
            // El permiso fue denegado
            localStorage.setItem("notificationPermission", "denied");
          }
        });
      }

      // Solicitar el permiso automáticamente al cargar la página
      requestNotificationPermission();

      // Verificar si ya se ha mostrado el popup
      if (!localStorage.getItem("popupShow")) {
        document.getElementById("popup").style.display = "block";
        document.getElementById("overlay").style.display = "block";

        // Marcar que el popup ha sido mostrado
        localStorage.setItem("popupShow", "true");
      }

      function closePopup() {
        document.getElementById("popup").style.display = "none";
        document.getElementById("overlay").style.display = "none";
      }
      // Función para mostrar una notificación con un mensaje aleatorio y una imagen
      function showRandomNotification() {
        // Mensajes aleatorios para la notificación
        const messages = [
          "¡Recuerda que hay una sección de descargas!",
          "¡Esta es una página sencilla pero se estará mejorando progresivamente, pulsa para más info!",
          "¡OPPSS, se me escapó un código oculto!",
        ];

        // Mensajes para la notificación
        const messageNoti = [
          "¡Recordatorio!",
          "¡Gracias por entrar a la página!",
          "111111",
        ];

        // Ruta de las imágenes para la notificación
        const imagePath = [
          "https://i.imgur.com/Ii0lsEv.png",
          "https://i.imgur.com/Ii0lsEv.png",
          "https://i.imgur.com/Ii0lsEv.png",
        ];

        // Destinos de redirección para la notificación
        const redirectDestinations = ["descargas", "info", "/"];

        // Obtener un índice aleatorio
        const randomIndex = Math.floor(Math.random() * messages.length);

        // Seleccionar el mensaje, la imagen y el destino de redirección correspondientes al índice aleatorio
        const randomMessage = messages[randomIndex];
        const randomMessageNoti = messageNoti[randomIndex];
        const randomImagePath = imagePath[randomIndex];
        const randomDestination = redirectDestinations[randomIndex];

        // Crear la notificación
        const notification = new Notification(randomMessageNoti, {
          body: randomMessage,
          icon: randomImagePath,
        });

        // Redirigir a un destino específico al hacer clic en la notificación
        notification.onclick = function () {
          // Redireccionar al destino aleatorio
          window.location.href = randomDestination;
        };
      }

      // Verificar si se ha dado permiso para las notificaciones
      if (localStorage.getItem("notificationPermission") === "granted") {
        // Generar un delay aleatorio entre 5 y 30 segundos (en milisegundos)
        const delay = Math.floor(Math.random() * (30000 - 5000 + 1)) + 5000;

        // Esperar el tiempo aleatorio y luego mostrar la notificación
        setTimeout(showRandomNotification, delay);
      }

      // Función para obtener el valor de una cookie
      function getCookie(name) {
        const cookieValue = document.cookie.match(
          "(^|;)\\s*" + name + "\\s*=\\s*([^;]+)"
        );
        return cookieValue ? cookieValue.pop() : "";
      }

      // Mostrar la notificación cada 5 o 10 minutos
      setInterval(
        showRandomNotification,
        Math.random() >= 0.5 ? 300000 : 600000
      );
    </script>-->
    <script>
      let deferredPrompt; 

window.addEventListener('beforeinstallprompt', (e) => {
  // Previene que el evento sea disparado automáticamente
  e.preventDefault();
  // Guarda el evento para más tarde
  deferredPrompt = e;

  // Muestra el botón de instalación
  const installButton = document.getElementById('dw-1');
  installButton.style.display = 'block';

  installButton.addEventListener('click', () => {
    // Muestra el diálogo de instalación
    deferredPrompt.prompt();
    deferredPrompt.userChoice.then((choiceResult) => {
      if (choiceResult.outcome === 'accepted') {
        console.log('Usuario aceptó la instalación');
      } else {
        console.log('Usuario rechazó la instalación');
      }
      deferredPrompt = null; // Resetea el evento
    });
  });
});
    </script>
<script>
  // Solicitar permiso de notificación si aún no se ha hecho
  function requestNotificationPermission() {
    if ('Notification' in window) {
      Notification.requestPermission().then((permission) => {
        localStorage.setItem('notificationPermission', permission);
        if (permission === 'granted') {
          maybeShowInitialNotification(); // Ahora sí se ejecuta tras permiso
          startNotificationInterval();    // También se inicia aquí
        }
      });
    }
  }

  // Mostrar popup si no se ha mostrado antes
  function showPopupOnce() {
    if (!localStorage.getItem('popupShow')) {
      const popup = document.getElementById('popup');
      const overlay = document.getElementById('overlay');
      if (popup && overlay) {
        popup.style.display = 'block';
        overlay.style.display = 'block';
        localStorage.setItem('popupShow', 'true');
      }
    }
  }

  // Cerrar el popup
  function closePopup() {
    const popup = document.getElementById('popup');
    const overlay = document.getElementById('overlay');
    if (popup && overlay) {
      popup.style.display = 'none';
      overlay.style.display = 'none';
    }
  }

  // Mostrar una notificación aleatoria
  function showRandomNotification() {
    if (!('Notification' in window)) return;

    const messages = [
      "¡Recuerda que hay una sección de descargas!",
      "¡Esta es una página sencilla pero se estará mejorando progresivamente, pulsa para más info!",
      "¡OPPSS, se me escapó un código oculto!",
    ];

    const titles = [
      "¡Recordatorio!",
      "¡Gracias por entrar a la página!",
      "111111",
    ];

    const icons = [
      "https://i.imgur.com/Ii0lsEv.png",
      "https://i.imgur.com/Ii0lsEv.png",
      "https://i.imgur.com/Ii0lsEv.png",
    ];

    const links = ["descargas", "info", "/"];

    const i = Math.floor(Math.random() * messages.length);

    try {
      const notification = new Notification(titles[i], {
        body: messages[i],
        icon: icons[i],
      });

      notification.onclick = () => {
        window.location.href = links[i];
      };
    } catch (error) {
      console.error('Error al mostrar la notificación:', error);
    }
  }

  // Mostrar notificación después de delay aleatorio (1 a 30 seg)
  function maybeShowInitialNotification() {
    const delay = Math.floor(Math.random() * (30000 - 1000 + 1)) + 1000;
    console.log("Notificación inicial en " + delay + " ms");
    setTimeout(showRandomNotification, delay);
  }

  // Notificación cada 5 o 10 minutos
  function startNotificationInterval() {
    const interval = Math.random() >= 0.5 ? 300000 : 600000;
    console.log("Notificaciones recurrentes cada " + interval + " ms");
    setInterval(showRandomNotification, interval);
  }

  // Ejecutar funciones al cargar
  document.addEventListener("DOMContentLoaded", () => {
    requestNotificationPermission();
    showPopupOnce();
  });
</script>
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js')
      .then(reg => console.log('SW registrado:', reg))
      .catch(err => console.error('SW error:', err));
  }
</script>
  </body>
</html>
